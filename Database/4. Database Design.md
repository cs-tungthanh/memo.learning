# Which requirement be consider when choosing Database ?
- In modern technologies, horizontal scaling is extremely popular.
- That's why we will run our instance in multiple nodes (node is a separated machine), and we need to consider synchronization data between multiple instances.
- We have several architecture such as: leader-follower, master-less, master-replicas

# Rule
If we use **Partition** -> trace off between **Consistency** and **Availability**
Else (don't use **Partition**) -> trade off between **Latency** and **Consistency**

- If we wait for all nodes to confirm the write -> get **strong consistency** -> **slower**
	- -> (lower availability)
- otherwise you respond immediately after one completed write -> other may not work as expected or lag -> **lower consistency**

# CAP theorem
## **C - Consistency**
**Consistency** means that all clients see the same data at the same time, no matter which node they connect to.
For this to happen, whenever data is written to one node, it must be instantly forwarded or replicated to all the other nodes in the system before the write is deemed successful.
- For instance, DB have one master node and 3 replicas nodes, when write command arrive at master, it will be propagated into replicas, in this point, our system could be crash or restarted, or when multiple write could lead to data race condition (is mentioned in slide Distributed lock Redis). 
- From now, our data could be harmful and we need mechanism to solve them.
## **A - Availability**
**Availability** means that any client making a request for data gets a response, even if one or more nodes are down. Another way to state thisâ€”all working nodes in the distributed system return a valid response for any request, without exception.
- For instance, In simple case, we have 1 DB or Redis node, and when this node is down, my system will have downtime. That why we need multiple instances (horizontal scaling) to achieve Availability characteristic 
## **P - Partition tolerance**
A partition is a communications break within a distributed systemâ€”a lost or temporarily delayed connection between two nodes. 
**Partition tolerance** means the system keeps running even when that happens.
- A **partition** can lead to **conflicting data**, such as when two users **concurrently write** to different parts of the system.

# Analyze CAP theorem in specific Database
Some database only satisfy 2 out of 3 property of CAP theorem
## **CP database**:
- The system **keeps data consistent**, even during network issues.
- But to do that, it may **refuse requests** (become unavailable) if it canâ€™t guarantee up-to-date data.
- **Weâ€™d rather give no answer than a wrong one**
## **AP database**: 
- Example: **Cassandra, Couchbase, DynamoDB**
- The system **stays available**, even during a partition.
- **Weâ€™re always responsive, but may show old info temporarily.**
## **CA database** - no partition
- Traditional relational DBs in a single server
- **We work wellâ€”until the network breaks.**

## MongoDB and CAP theorem
- Mongodb is **CP database**, frequently used for big data and real-time applications but compromising on availability
- Mongodb is a single-master system. Only one primary node receives all write operations, all other nodes are secondary that replicate primary node log
- When primary node is down, its replica is elected as master.
- Why not satisfy availability? Because of single-master
- Because of single master, so it won't suffered conflict between concurrent write (this case mentioned above) into multiple leaders like SQL --> ensure <ins>partition tolerance</ins>, which is a problem with DB like Postgresql, 

# Question
# ðŸ“š CAP Theorem â€“ Interview Questions

## ðŸ”¹ Basic Understanding

1. **What is the CAP theorem? Can you explain each component briefly?**
2. **Why can't a distributed system guarantee all three: Consistency, Availability, and Partition Tolerance?**
3. **What is the difference between consistency in CAP and ACID consistency?**

## ðŸ”¹ Behavior Under Partition

4. **During a network partition, how does a CP system behave?**
5. **What would an AP system do in the same situation?**
6. **Can you give a real-world example of a partition in a distributed system?**

## ðŸ”¹ Database Classification

7. **Can you name databases that are CP, AP, or CA, and explain why they fall into that category?**
8. **Is it possible to tune a database like Cassandra to be more consistent? How?**
9. **Why is CA considered theoretical in a distributed system?**

## ðŸ”¹ Trade-offs & Design

10. **If you were building a financial system (e.g., bank transfers), would you choose CP or AP? Why?**
11. **What would you prioritize in a messaging app: consistency or availability?**
12. **How can eventual consistency be acceptable in some systems? Can you give examples?**
13. **How would you handle data conflicts in an AP system?**

## ðŸ”¹ Advanced Thinking

14. **What are some strategies to mitigate consistency issues in AP systems?**
15. **Can you design a write conflict resolution mechanism for an eventually consistent system?**
16. **How does quorum-based replication relate to the CAP theorem?**
17. **How do modern databases like MongoDB or DynamoDB balance the CAP properties in practice?**
